<beast>

	<taxa id="taxa">
		<taxon id="a"/>
		<taxon id="b"/>
        <taxon id="c"/>
        <taxon id="d"/>
        <taxon id="e"/>
        <taxon id="f"/>
        <taxon id="g"/>
        <taxon id="h"/>
	</taxa>

	<birthDeathSimulator id="trueTree">
		<birthRate>
			<parameter id="trueBirthRate" value="2.0"/>
		</birthRate>
		<deathRate>
			<parameter id="trueDeathRate" value="1.0"/>
		</deathRate>
		<taxa idref="taxa"/>
	</birthDeathSimulator>

	<frequencyModel id="frequencyModel" dataType="nucleotide">
		<frequencies>
			<parameter id="frequencies" value="0.35 0.30 0.20 0.15"/>
		</frequencies>
	</frequencyModel>

	<sequenceSimulator id="alignment" replications="2048">
		<beast_siteModel>
			<substitutionModel>
				<beast_hkyModel>
					<frequencies>
                    	<beast_frequencyModel dataType="nucleotide">
                    		<frequencies>
                    			<parameter idref="frequencies"/>
                    		</frequencies>
                    	</beast_frequencyModel>
					</frequencies>
					<kappa>
						<parameter value="8.0" lower="1.0E-8" upper="Infinity"/>
					</kappa>
				</beast_hkyModel>
			</substitutionModel>
		</beast_siteModel>
		<birthDeathSimulator idref="trueTree"/>
		<strictClockBranchRates id="branchRates">
			<rate>
				<parameter id="clock.rate" value="0.01"/>
			</rate>
		</strictClockBranchRates>
	</sequenceSimulator>

	<patterns id="patterns">
		<sequenceSimulator idref="alignment"/>
	</patterns>

	<randomizeHeights id="startingTree">
		<tree idref="trueTree"/>
	</randomizeHeights>

	<birthDeathModel id="mcmc.birthDeath" units="substitutions">
		<birthMinusDeathRate>
			<parameter id="mcmc.birthDeath.meanGrowthRate" value="1.0" lower="0.0" upper="1000000.0"/>
		</birthMinusDeathRate>
		<relativeDeathRate>
			<parameter id="mcmc.birthDeath.relativeDeathRate" value="0.5" lower="0.0" upper="1.0"/>
		</relativeDeathRate>
	</birthDeathModel>

	<treeModel id="mcmc.treeModel">
		<randomizeHeights idref="startingTree"/>
		<rootHeight>
			<parameter id="mcmc.treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="mcmc.treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="mcmc.treeModel.allInternalNodeHeights"/>
		</nodeHeights>
	</treeModel>

	<speciationLikelihood id="mcmc.speciation">
		<model>
			<birthDeathModel idref="mcmc.birthDeath"/>
		</model>
		<speciesTree>
			<treeModel idref="mcmc.treeModel"/>
		</speciesTree>
	</speciationLikelihood>

	<treeLikelihood id="mcmc.treeLikelihood" useAmbiguities="false">
		<patterns idref="patterns"/>
		<treeModel idref="mcmc.treeModel"/>
		<siteModel>
			<substitutionModel>
				<hkyModel>
					<frequencies>
						<frequencyModel idref="frequencyModel"/>
					</frequencies>
					<kappa>
						<parameter id="mcmc.kappa" value="1.0" lower="1.0E-8" upper="Infinity"/>
					</kappa>
				</hkyModel>
			</substitutionModel>
		</siteModel>
		<strictClockBranchRates idref="branchRates"/>
	</treeLikelihood>

	<posterior id="mcmc.posterior">
		<prior id="mcmc.prior">
			<oneOnXPrior>
				<parameter idref="mcmc.kappa"/>
			</oneOnXPrior>
			<speciationLikelihood idref="mcmc.speciation"/>
		</prior>
		<likelihood id="mcmc.likelihood">
			<treeLikelihood idref="mcmc.treeLikelihood"/>
		</likelihood>
	</posterior>

    <operators id="mcmc.operators">
        <scaleOperator scaleFactor="0.75" weight="1">
            <parameter idref="mcmc.kappa"/>
        </scaleOperator>
		<scaleOperator scaleFactor="0.75" weight="3">
			<parameter idref="mcmc.birthDeath.meanGrowthRate"/>
		</scaleOperator>
		<scaleOperator scaleFactor="0.75" weight="3">
			<parameter idref="mcmc.birthDeath.relativeDeathRate"/>
		</scaleOperator>
        <scaleOperator scaleFactor="0.75" weight="3">
            <parameter idref="mcmc.treeModel.rootHeight"/>
        </scaleOperator>
        <!-- <uniformOperator weight="30">
            <parameter idref="mcmc.treeModel.internalNodeHeights"/>
        </uniformOperator> -->
    </operators>

    <!-- <mcmc id="mcmc" chainLength="10000000" autoOptimize="true">
        <posterior idref="mcmc.posterior"/>
        <operators idref="mcmc.operators"/>
        <log logEvery="1000000">
            <column label="Posterior" dp="4" width="12">
                <posterior idref="mcmc.posterior"/>
            </column>
            <column label="Prior" dp="4" width="12">
                <prior idref="mcmc.prior"/>
            </column>
            <column label="Likelihood" dp="4" width="12">
                <likelihood idref="mcmc.likelihood"/>
            </column>
            <column label="Root Height" sf="6" width="12">
                <parameter idref="mcmc.treeModel.rootHeight"/>
            </column>
            <column label="Rate" sf="6" width="12">
                <parameter idref="clock.rate"/>
            </column>
        </log>
        <log logEvery="1000" fileName="mcmc.log">
            <posterior idref="mcmc.posterior"/>
            <prior idref="mcmc.prior"/>
            <likelihood idref="mcmc.likelihood"/>
            <parameter idref="mcmc.treeModel.allInternalNodeHeights"/>
            <parameter idref="mcmc.birthDeath.meanGrowthRate"/>
            <parameter idref="mcmc.birthDeath.relativeDeathRate"/>
            <parameter idref="mcmc.kappa"/>
            <parameter idref="clock.rate"/>
            <treeLikelihood idref="mcmc.treeLikelihood"/>
            <speciationLikelihood idref="mcmc.speciation"/>
        </log>
    </mcmc>

    <report>
        <property name="timer">
            <mcmc idref="mcmc"/>
        </property>
    </report> -->

	<birthDeathModel id="hmc.birthDeath" units="substitutions">
		<birthMinusDeathRate>
			<parameter id="hmc.birthDeath.meanGrowthRate" value="1.0" lower="0.0" upper="1000000.0"/>
		</birthMinusDeathRate>
		<relativeDeathRate>
			<parameter id="hmc.birthDeath.relativeDeathRate" value="0.5" lower="0.0" upper="1.0"/>
		</relativeDeathRate>
	</birthDeathModel>

	<treeModel id="hmc.treeModel">
		<randomizeHeights idref="startingTree"/>
		<rootHeight>
			<parameter id="hmc.treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="hmc.treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="hmc.treeModel.allInternalNodeHeights"/>
		</nodeHeights>
	</treeModel>

	<speciationLikelihood id="hmc.speciation">
		<model>
			<birthDeathModel idref="mcmc.birthDeath"/>
		</model>
		<speciesTree>
			<treeModel idref="hmc.treeModel"/>
		</speciesTree>
	</speciationLikelihood>

	<treeLikelihood id="hmc.treeLikelihood" useAmbiguities="false">
		<patterns idref="patterns"/>
		<treeModel idref="hmc.treeModel"/>
		<siteModel>
			<substitutionModel>
				<hkyModel>
					<frequencies>
						<frequencyModel idref="frequencyModel"/>
					</frequencies>
					<kappa>
						<parameter id="hmc.kappa" value="1.0" lower="1.0E-8" upper="Infinity"/>
					</kappa>
				</hkyModel>
			</substitutionModel>
		</siteModel>
		<strictClockBranchRates idref="branchRates"/>
	</treeLikelihood>

	<posterior id="hmc.posterior">
		<prior id="hmc.prior">
            <!-- <oneOnXPrior>
                <parameter idref="hmc.kappa"/>
            </oneOnXPrior> -->
			<speciationLikelihood idref="hmc.speciation"/>
		</prior>
        <!-- <likelihood id="hmc.likelihood">
            <treeLikelihood idref="hmc.treeLikelihood"/>
        </likelihood> -->
	</posterior>

    <operators id="hmc.operators">
		<hamiltonUpdate iterations="100" weight="1">
			<potential>
				<posterior idref="hmc.posterior"/>
			</potential>
			<dimensions>
                <!-- <parameter idref="hmc.kappa"/> -->
				<parameter idref="hmc.treeModel.internalNodeHeights"/>
				<parameter idref="hmc.birthDeath.meanGrowthRate"/>
				<parameter idref="hmc.birthDeath.relativeDeathRate"/>
			</dimensions>
		</hamiltonUpdate>
    </operators>

	<mcmc id="hmc" chainLength="100000" autoOptimize="true">
		<posterior idref="hmc.posterior"/>
		<operators idref="hmc.operators"/>
		<log logEvery="10000">
			<column label="Posterior" dp="4" width="12">
				<posterior idref="hmc.posterior"/>
			</column>
			<column label="Prior" dp="4" width="12">
				<prior idref="hmc.prior"/>
			</column>
            <!-- <column label="Likelihood" dp="4" width="12">
                <likelihood idref="hmc.likelihood"/>
            </column> -->
			<column label="Root Height" sf="6" width="12">
				<parameter idref="hmc.treeModel.rootHeight"/>
			</column>
			<column label="Rate" sf="6" width="12">
				<rateStatistic idref="clock.rate"/>
			</column>
		</log>
		<log logEvery="10" fileName="hmc.log">
			<posterior idref="hmc.posterior"/>
			<prior idref="hmc.prior"/>
            <!-- <likelihood idref="hmc.likelihood"/> -->
			<parameter idref="hmc.treeModel.allInternalNodeHeights"/>
			<parameter idref="hmc.birthDeath.meanGrowthRate"/>
			<parameter idref="hmc.birthDeath.relativeDeathRate"/>
			<parameter idref="hmc.kappa"/>
			<parameter idref="clock.rate"/>
			<treeLikelihood idref="hmc.treeLikelihood"/>
			<speciationLikelihood idref="hmc.speciation"/>
		</log>
	</mcmc>

	<report>
		<property name="timer">
			<mcmc idref="hmc"/>
		</property>
	</report>

</beast>